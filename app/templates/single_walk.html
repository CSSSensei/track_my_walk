{% extends "base.html" %}

{% block title %}Прогулка: {{ walk.name }}{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="https://cdn.jsdelivr.net/gh/IvanSanchez/Leaflet.Polyline.SnakeAnim@latest/L.Polyline.SnakeAnim.min.js"></script>
{% endblock %}

{% block header %}
    {% set show_theme_toggle = True %}
    {% include "partials/_public_header.html" %}
{% endblock %}

{% block body %}
<div class="content-wrapper">
<main class="container">
    <nav class="single-walk-topbar">
        <a href="{{ url_for('main.all_walks') }}" class="back-link">&larr; Ко всем прогулкам</a>
    </nav>

    <section class="walk-map-section card walk-map-hero">
        <div id="singleWalkMap" class="single-walk-map"></div>

        <div class="walk-meta-overlay" aria-label="Информация о прогулке">
            <div class="walk-meta-card">
                <h2 class="walk-meta-title">{{ walk.name }}</h2>

                {% if walk.description %}
                    <p class="walk-meta-description">{{ walk.description }}</p>
                {% endif %}

                <div class="walk-meta-stats">
                    <div class="walk-meta-pill">
                        <span class="walk-meta-pill-value" id="walkDate"></span>
                    </div>

                    <div class="walk-meta-pill">
                        <span class="walk-meta-pill-value">{{ "%.2f"|format(walk.distance) }} км</span>
                    </div>

                    {% if walk.co2_saved %}
                        <div class="walk-meta-pill">
                            <span class="walk-meta-pill-label">CO₂</span>
                            <span class="walk-meta-pill-value">{{ "%.2f"|format(walk.co2_saved) }} г</span>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
    {% if walk.photos %}
    <section class="walk-photos-section card">
        <h2>Фотографии</h2>
        <div id="photoGallery" class="photo-gallery">
            {% for photo in walk.photos %}
            <div class="photo-thumbnail" data-lat="{{ photo.latitude }}" data-lng="{{ photo.longitude }}" data-src="{{ photo.url }}">
                <img src="{{ photo.url }}" alt="Фото с прогулки" loading="lazy">
                {% if photo.description %}
                <div class="photo-thumbnail-description">{{ photo.description }}</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</main>
</div>

<script type="application/json" id="walkDataJson">{{ walk | tojson }}</script>
{% endblock %}

{% block footer %}
<footer style="text-align: center; margin-top: 20px; padding-bottom: 20px;">
    <p id="copyrightText" style="font-size: 0.9em; color: #888; cursor: pointer;">
        © 2025 Yan Toples, Inc.
    </p>
</footer>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', filename='js/pages/single_walk.js') }}"></script>
{% endblock %}
